<!-- Mobile Layout -->
<GridLayout rows="auto, auto, auto, *" height="100%" width="100%" class="mobile-container">
    <!-- ActionBar -->
    <ActionBar row="0" class="action-bar">
        <NavigationButton visibility="hidden"></NavigationButton>
        <GridLayout columns="50, *">
            <Label class="action-bar-title" text="è¨‚é–±ç®¡ç†" colSpan="2"></Label>
            <Label class="fas" text="&#xf0c9;" (tap)="onDrawerButtonTap()"></Label>
        </GridLayout>
    </ActionBar>
    
    <!-- Top Header -->
    <GridLayout row="1" columns="auto, *, auto" class="mobile-header">
        <Label col="0" text="ðŸ“‹" class="app-icon"></Label>
        <Label col="1" text="è¨‚é–±ç®¡ç†" class="page-title"></Label>
        <Button col="2" text="ðŸ”„" (tap)="onSync()" class="sync-btn"></Button>
    </GridLayout>
    
    <!-- Tab Navigation -->
    <GridLayout row="2" columns="*, *" class="tab-navigation">
        <Button col="0" [text]="'ðŸ“‹ è¨‚é–±æ¸…å–® (' + subscriptions.length + ')'" 
                [class]="'tab-btn ' + (activeTab === 'list' ? 'active' : '')" 
                (tap)="setActiveTab('list')"></Button>
        <Button col="1" text="âž• æ–°å¢žè¨‚é–±" 
                [class]="'tab-btn ' + (activeTab === 'add' ? 'active' : '')" 
                (tap)="setActiveTab('add')"></Button>
    </GridLayout>
    
    <!-- Content Area -->
    <GridLayout row="3" class="content-area">
        <!-- Subscription List View -->
        <ScrollView *ngIf="activeTab === 'list'" class="subscription-list-view">
            <StackLayout class="subscription-items-mobile">
                <!-- Action Bar -->
                <GridLayout columns="*, auto, auto, auto" class="action-bar-mobile">
                    <Label col="0" [text]="getConnectionStatus()" [class]="'connection-status ' + getConnectionStatusClass()"></Label>
                    <Button col="1" text="ðŸ”" (tap)="onSearch()" class="action-btn-small"></Button>
                    <Button col="2" text="ðŸ·ï¸" (tap)="onFilterByCategory()" class="action-btn-small"></Button>
                    <Button col="3" text="â°" (tap)="onCheckExpiring()" class="action-btn-small"></Button>
                </GridLayout>

                <!-- Loading Indicator -->
                <ActivityIndicator *ngIf="isLoading" busy="true" class="loading-indicator"></ActivityIndicator>

                <GridLayout *ngFor="let item of subscriptions" columns="auto, *, auto" class="subscription-item-mobile" (tap)="onCardTap(item)">
                    <!-- Service Icon -->
                    <StackLayout col="0" class="service-icon-mobile">
                        <Label text="ðŸ’³" class="service-icon-text" *ngIf="item.price > 0"></Label>
                        <Label text="ðŸ†“" class="service-icon-text" *ngIf="item.price === 0"></Label>
                    </StackLayout>
                    
                    <!-- Service Details -->
                    <StackLayout col="1" class="service-details-mobile">
                        <Label [text]="item.name" class="service-name-mobile" textWrap="true"></Label>
                        <GridLayout columns="auto, auto, *" class="service-meta-mobile">
                            <Label col="0" [text]="item.price === 0 ? 'å…è²»' : 'NT$' + item.price" class="meta-text-mobile price-mobile"></Label>
                            <Label col="1" [text]="item.category" class="meta-text-mobile category-mobile" *ngIf="item.category"></Label>
                        </GridLayout>
                        <Label [text]="'ä¸‹æ¬¡ä»˜æ¬¾: ' + formatDate(item.nextDate)" class="next-payment-mobile"></Label>
                        <Label [text]="item.account" class="account-name-mobile" *ngIf="item.account"></Label>
                    </StackLayout>
                    
                    <!-- Action Button -->
                    <StackLayout col="2" class="action-btn-container-mobile">
                        <Button text="â‹¯" (tap)="onCardMenu(item, $event)" class="menu-btn-mobile"></Button>
                    </StackLayout>
                </GridLayout>
                
                <!-- Empty State -->
                <StackLayout *ngIf="subscriptions.length === 0 && !isLoading" class="empty-state">
                    <Label text="ðŸ“‹" class="empty-icon"></Label>
                    <Label text="å°šç„¡è¨‚é–±è³‡æ–™" class="empty-text"></Label>
                    <Label text="é»žæ“Šä¸Šæ–¹ã€Œæ–°å¢žè¨‚é–±ã€é–‹å§‹æ·»åŠ " class="empty-hint"></Label>
                </StackLayout>
            </StackLayout>
        </ScrollView>
        
        <!-- Add Subscription Form -->
        <ScrollView *ngIf="activeTab === 'add'" class="add-subscription-view">
            <StackLayout class="form-content-mobile">
                <!-- Name Field -->
                <StackLayout class="form-group-mobile">
                    <Label text="æœå‹™åç¨±" class="form-label-mobile"></Label>
                    <TextField [(ngModel)]="newSubName" hint="è«‹è¼¸å…¥æœå‹™åç¨±" class="form-input-mobile"></TextField>
                </StackLayout>
                
                <!-- Price and Category Row -->
                <GridLayout columns="*, 15, *" class="form-group-mobile">
                    <StackLayout col="0">
                        <Label text="æœˆè²»åƒ¹æ ¼ (NT$)" class="form-label-mobile"></Label>
                        <TextField [(ngModel)]="newSubPrice" keyboardType="number" hint="0" class="form-input-mobile"></TextField>
                    </StackLayout>
                    
                    <StackLayout col="2">
                        <Label text="é¡žåˆ¥" class="form-label-mobile"></Label>
                        <TextField [(ngModel)]="newSubCategory" hint="ä¾‹å¦‚: ä¸²æµåª’é«”" class="form-input-mobile"></TextField>
                    </StackLayout>
                </GridLayout>
                
                <!-- Next Payment Date -->
                <StackLayout class="form-group-mobile">
                    <Label text="ä¸‹æ¬¡ä»˜æ¬¾æ—¥æœŸ" class="form-label-mobile"></Label>
                    <GridLayout columns="*, 10, *, 10, *" class="date-inputs-mobile">
                        <TextField col="0" [(ngModel)]="newSubDateYear" keyboardType="number" hint="å¹´" class="form-input-mobile date-input-mobile"></TextField>
                        <TextField col="2" [(ngModel)]="newSubDateMonth" keyboardType="number" hint="æœˆ" class="form-input-mobile date-input-mobile"></TextField>
                        <TextField col="4" [(ngModel)]="newSubDateDay" keyboardType="number" hint="æ—¥" class="form-input-mobile date-input-mobile"></TextField>
                    </GridLayout>
                </StackLayout>
                
                <!-- Website Field -->
                <StackLayout class="form-group-mobile">
                    <Label text="å®˜æ–¹ç¶²ç«™" class="form-label-mobile"></Label>
                    <TextField [(ngModel)]="newSubSite" hint="https://..." class="form-input-mobile"></TextField>
                </StackLayout>
                
                <!-- Account Field -->
                <StackLayout class="form-group-mobile">
                    <Label text="å¸³è™Ÿè³‡è¨Š" class="form-label-mobile"></Label>
                    <TextField [(ngModel)]="newSubAccount" hint="ç™»å…¥å¸³è™Ÿæˆ–å‚™è¨»" class="form-input-mobile"></TextField>
                </StackLayout>

                <!-- Description Field -->
                <StackLayout class="form-group-mobile">
                    <Label text="æœå‹™èªªæ˜Ž" class="form-label-mobile"></Label>
                    <TextField [(ngModel)]="newSubDescription" hint="æœå‹™æè¿°" class="form-input-mobile"></TextField>
                </StackLayout>
                
                <!-- Note Field -->
                <StackLayout class="form-group-mobile">
                    <Label text="å‚™è¨»" class="form-label-mobile"></Label>
                    <TextView [(ngModel)]="newSubNote" hint="å…¶ä»–å‚™è¨»è³‡è¨Š..." class="field-textarea"></TextView>
                </StackLayout>

                <!-- Quick Templates -->
                <StackLayout class="form-group-mobile">
                    <Label text="å¿«é€Ÿæ¨¡æ¿" class="form-label-mobile"></Label>
                    <GridLayout columns="*, *, *" class="template-grid-mobile">
                        <Button col="0" text="ðŸ“º Netflix" class="template-btn-mobile" (tap)="useTemplate('netflix')"></Button>
                        <Button col="1" text="ðŸŽµ Spotify" class="template-btn-mobile" (tap)="useTemplate('spotify')"></Button>
                        <Button col="2" text="â˜ï¸ iCloud" class="template-btn-mobile" (tap)="useTemplate('icloud')"></Button>
                    </GridLayout>
                </StackLayout>
                
                <!-- Action Buttons -->
                <GridLayout columns="*, 15, *" class="action-buttons-mobile">
                    <Button col="0" text="æ¸…é™¤" (tap)="clearForm()" class="clear-btn-mobile"></Button>
                    <Button col="2" text="æ–°å¢žè¨‚é–±" (tap)="onAdd()" class="add-btn-mobile"></Button>
                </GridLayout>
            </StackLayout>
        </ScrollView>
    </GridLayout>
</GridLayout>